<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.mapper.CartMapper">
<!-- 장바구니 추가 -->
	<insert id="addCart">
		insert into campus_cart(c_cartnumber, u_userid, p_number, c_count)
		values(campus_cart_seq.nextval, #{u_userid} , #{p_number} ,#{c_count})
	</insert>
	
	<!--  장바구니에 기존 상품이 있는지  -->
	<select id="countCart" resultType="int">
	select count(*) from cart
	where u_userid=#{u_userid} and p_number=#{p_number}
	</select>
	
    <!-- 장바구니 목록 --> 
   <select id="listCart" resultType="com.spring.domain.CartVO">
      select p.p_number, u.u_userid, c.c_cartnumber, u.u_username, 
      p.p_name, c.c_count, p.p_price
      from campus_cart c, campus_user u , campus_product p
      where u.u_userid = c.u_userid
      and p.p_number = c.p_number
      and c.u_userid=#{u_userid}
      order by c_cartnumber desc
   </select>
   
   <!-- 결제용 -->
   <select id="listPayment" resultType="com.spring.domain.CartPaymentVO">
      select p.p_number, u.u_userid, c.c_cartnumber, u.u_username, 
      p.p_name, c.c_count, p.p_price, p.p_shippingfee
      from campus_cart c, campus_user u , campus_product p
      where u.u_userid = c.u_userid
      and p.p_number = c.p_number
      and c.u_userid=#{u_userid}
      order by c_cartnumber desc
   </select>
   

   <!-- 장바구니 전체 금액 -->  
   <select id="sum" resultType="int">
      select NVL(SUM(p_price * c_count),0) money
      from campus_cart c, campus_product p
      where c.p_number = p.p_number and c.u_userid = #{u_userid}
   </select>

    <!-- 장바구니 수정 --> 
   <update id="modifyCart">
      update campus_cart
      set c_count = #{c_count}
      where u_userid = #{u_userid}
      and p_name = #{p_name}
   </update>
   <update id="update">
   update campus_cart
   set c_count = #{c_count}
   where u_userid = #{u_userid}
   and c_cartnumber = #{c_cartnumber}
   </update>

    <!-- 장바구니 삭제 --> 
   <delete id="delete">
      delete from campus_cart
      where c_cartnumber = #{c_cartnumber}
   </delete>
   <delete id="deleteAll">
   delete from campus_cart
   where u_userid=#{u_userid}
   </delete>

</mapper>